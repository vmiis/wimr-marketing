<div id=toolbar__ID>
    <button id=query__ID type=button class="btn btn-secondary" title='Query' style='vertical-align: top;margin-right:30px'>Query</button>
    <span style="margin-right:100px"> </span> 
    Total Number of records: <span id=total__ID></span>
    <button id=export__ID type=button class="btn btn-secondary" title='Export' style='vertical-align: top;margin-left:30px'>Export</button>
</div>
<div>
<table id="grid__ID"></table>
</div>

<script>
    function F__ID(){
        //-------------------------------------------------
        var name="2022-03";
        //-------------------------------------------------
        var m=$vm.module_list['__MODULE__'];
        //-------------------------------------------------
        var columns=`
            Date|Submit_date
            First Name|Data.First Name
            Surname|Data.Surname
            Email|Data.Patient Email
            Date of Birth|Data.DOB
            Gender|Data.Gender
            Postcode|Data.Postcode
            Newsletter|Data.Consent checkbox - correspondence
            Research|Data.Interest in Research
            Obstructive Sleep Apnoea (OSA)|Data.Obstructive Sleep Apnoea (OSA)
            Insomnia|Data.Insomnia
            Narcolepsy|Data.Narcolepsy
            Restless Leg Syndrome (RLS)|Data.Restless Leg Syndrome (RLS)
            Asthma|Asthma
            Lung Cancer|Data.Lung Cancer
            Chronic Obstructive Pulmonary Disease (COPD)|Data.Chronic Obstructive Pulmonary Disease (COPD),
            Emphysema|Data.Emphysema
            Chronic Bronchitis|Data.Chronic Bronchitis
            Rhinitis|Data.Rhinitis
            None|Data.None of the above
        `;
        //-------------------------------------------------
        var records=[];
        var query=function(){
            var dt1="ISODate(2022-03-01)";
            var dt2="ISODate(2022-04-01)";
            $vm.request({cmd:"find",table:m.Table,query:{"Data.Consent checkbox - correspondence":"Yes",Submit_date:{"$gte":dt1,"$lt":dt2}},options:{}},function(res){
                records=$vm.grid_render_1("__ID", {
                    name:name,
                    columns:columns,
                    rows:res.result,
                },
                cell_render);
                $('#total__ID').text(records.length);
            });
        }
        var cell_render=function(header,c){
            if(header) return c.substr(0,10);
            return c;
        }
        //-------------------------------------------------
        $('#D__ID').on('load',function(){
            query();
        })
        //-------------------------------------------------
        $('#query__ID').on('click',function(){
            query();
        })
        //-------------------------------------------------
        $('#export__ID').on('click',function(){
            if(records!=[]) $vm.download_csv(name+".csv",records);
        })
        //-------------------------------------------------       
    }
</script>
<style>
    #D__ID{
        height:100%;
        background-color:#fff;
    }

    #toolbar__ID{
        background-color:#ccc;
        padding:5px 10px;
        margin-bottom:0px;
        overflow:hidden
    }
    #D__ID table{
        font-size:13px;
        font-family: Helvetica, Arial, sans-serif;
    }
    #grid__ID{
        border-collapse: collapse;
        border-spacing: 0;
        margin: 0;
        border-width: 0;
    }
    #grid__ID th{
        font-weight: bold;
        background-color:#EEE;
        padding:5px;
        border: 1px solid #CCC;
    }
    #grid__ID td{
        font-weight: 300;
        /*background-color:#FFF;*/
        padding:3px;
        border: 1px solid #CCC;
        vertical-align: top;
        white-space: pre;
        background-color: white;
    }

    #grid__ID tr:hover { 
        background-color:#EEE; 
    }        
    
    #grid__ID tr td:first-child{
        padding-left:10px;
        padding-right:10px;
        background-color:#EEE;
    }
</style>
